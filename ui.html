<body>
    <div><button id="enable-box2d">Enable</button></div>
    <div><button id="start-simulating">Start</button></div>
    <div><button id="stop-simulating">Stop</button></div>
    <div><input id="controls"></input></div>
</body>

<script>
  ////////////////////////////////////////////////////
  // INPUTS
  ////////////////////////////////////////////////////

  const keysDown = {};

  function getChar(e) {
    if (e.keyCode >= 48 && e.keyCode <= 90)
      return String.fromCharCode(e.keyCode).toLowerCase();

    return null;
  }

  document.getElementById('controls').addEventListener('keydown', e => {
    let key = getChar(e);
    if (key) keysDown[key] = true;
    parent.postMessage({ pluginMessage: { type: 'controls', keysDown } }, '*');
  });

  document.getElementById('controls').addEventListener('keyup', e => {
    let key = getChar(e);
    if (key) keysDown[key] = false;
    parent.postMessage({ pluginMessage: { type: 'controls', keysDown } }, '*');
  });

  ////////////////////////////////////////////////////
  // PHYSICS
  ////////////////////////////////////////////////////

  document.getElementById('enable-box2d').onclick = () => {
    parent.postMessage({ pluginMessage: { type: 'enable-box2d' } }, '*')
  }

  let nextAnimationFrame;
  function runLoop() {
    document.getElementById('controls').value = '';
    nextAnimationFrame = requestAnimationFrame(runLoop);
    parent.postMessage({ pluginMessage: { type: 'step' } }, '*')
  }

  document.getElementById('start-simulating').onclick = () => {
    runLoop();
  }
  document.getElementById('stop-simulating').onclick = () => {
    cancelAnimationFrame(nextAnimationFrame)
  }

  parent.postMessage({ pluginMessage: { type: 'start-box2d' } }, '*');
  runLoop();

</script>